<html>
<head>
<title>poll.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
.s0 { color: rgb(98,151,85); font-style: italic; }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(204,120,50); font-weight: bold; }
.s3 { color: rgb(106,135,89); }
.s4 { color: rgb(204,120,50); }
.s5 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#C0C0C0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
poll.js</FONT>
</center></TD></TR></TABLE>
<pre>

<span class="s0">/** 
 * Created by lbhurtado on 10/2/15. 
 */</span><span class="s1"> 
 
</span><span class="s2">function </span><span class="s1">toTitleCase(str) { 
    </span><span class="s2">return </span><span class="s1">str.replace(</span><span class="s3">/\w\S*/g</span><span class="s4">, </span><span class="s2">function </span><span class="s1">(txt) { 
        </span><span class="s2">return </span><span class="s1">txt.charAt(</span><span class="s5">0</span><span class="s1">).toUpperCase() + txt.substr(</span><span class="s5">1</span><span class="s1">).toLowerCase()</span><span class="s4">;</span><span class="s1"> 
    })</span><span class="s4">;</span><span class="s1"> 
} 
 
</span><span class="s2">var </span><span class="s1">survey = 
{ 
    </span><span class="s3">'config'</span><span class="s1">: {}</span><span class="s4">,</span><span class="s1"> 
    </span><span class="s3">'prompts'</span><span class="s1">: { 
        </span><span class="s3">'Challenge'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s2">null</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;Bayan o sarili?&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^BAYAN$/i</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">(text) { 
                </span><span class="s2">if </span><span class="s1">(text.match(</span><span class="s2">this</span><span class="s1">.regex)) { 
                    </span><span class="s2">var </span><span class="s1">group = project.getOrCreateGroup(</span><span class="s3">'Bayan'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                    contact.addToGroup(group)</span><span class="s4">;</span><span class="s1"> 
                    state.id = </span><span class="s3">'opt-in'</span><span class="s4">;</span><span class="s1"> 
                } 
            }</span><span class="s4">,</span><span class="s1"> 
        }</span><span class="s4">,</span><span class="s1"> 
        </span><span class="s3">'Opt-in'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">&quot;opt-in&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;Welcome to the mock survey for the 2016 national and local elections. Get load credits for answering 4 questions. Reply with 'yes' to proceed.&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^YES$/i</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">(text) { 
                </span><span class="s2">if </span><span class="s1">(text.match(</span><span class="s2">this</span><span class="s1">.regex)) { 
                    </span><span class="s2">var </span><span class="s1">group = project.getOrCreateGroup(</span><span class="s3">'Opted In'</span><span class="s1">)</span><span class="s4">;</span><span class="s1"> 
                    contact.addToGroup(group)</span><span class="s4">;</span><span class="s1"> 
                    state.id = </span><span class="s3">'name'</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
        }</span><span class="s4">,</span><span class="s1"> 
        </span><span class="s3">'Name'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">&quot;name&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;What is your name?&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;No special characters please.&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^[a-zA-Z0-9\s]+$/</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">(text) { 
                </span><span class="s2">if </span><span class="s1">(text.match(</span><span class="s2">this</span><span class="s1">.regex)) { 
                    </span><span class="s2">var </span><span class="s1">name = message.content</span><span class="s4">;</span><span class="s1"> 
                    contact.name = toTitleCase(name.replace(</span><span class="s3">/[^\w\s]/gi</span><span class="s4">, </span><span class="s3">''</span><span class="s1">))</span><span class="s4">;</span><span class="s1"> 
                    state.id = </span><span class="s3">'q1'</span><span class="s4">;</span><span class="s1"> 
                } 
            } 
        }</span><span class="s4">,</span><span class="s1"> 
        </span><span class="s3">'Candidates'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">&quot;q1&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;[[contact.name]], who among the following is your best choice for president in 2016?&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;Select a letter only:&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'choices'</span><span class="s1">: { 
                </span><span class="s3">'R'</span><span class="s1">: </span><span class="s3">&quot;Sec. Mar Roxas&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'B'</span><span class="s1">: </span><span class="s3">&quot;VP Jojo Binay&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'P'</span><span class="s1">: </span><span class="s3">&quot;Sen. Grace Poe&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'D'</span><span class="s1">: </span><span class="s3">&quot;Mayor Rody Duterte&quot;</span><span class="s1"> 
            }</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^[RBPB]$/</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">(text) { 
                </span><span class="s2">var </span><span class="s1">code = message.content</span><span class="s4">;</span><span class="s1"> 
                contact.vars.candidate_code = code</span><span class="s4">;</span><span class="s1"> 
                contact.vars.candidate = </span><span class="s2">this</span><span class="s1">.choices[code]</span><span class="s4">;</span><span class="s1"> 
                state.id = </span><span class="s3">'q2'</span><span class="s4">;</span><span class="s1"> 
            } 
        }</span><span class="s4">,</span><span class="s1"> 
        </span><span class="s3">'Reasons'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">&quot;q2&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;[[contact.name]], why did you choose contact.vars.candidate?&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;Select a numeral only:&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'choices'</span><span class="s1">: { 
                </span><span class="s3">'1'</span><span class="s1">: </span><span class="s3">&quot;Leadership&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'2'</span><span class="s1">: </span><span class="s3">&quot;Program or Agenda&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'3'</span><span class="s1">: </span><span class="s3">&quot;Personality&quot;</span><span class="s1"> 
            }</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^[123]$/</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">() { 
                </span><span class="s2">var </span><span class="s1">code = message.content</span><span class="s4">;</span><span class="s1"> 
                contact.vars.reason_code = code</span><span class="s4">;</span><span class="s1"> 
                contact.vars.reason = </span><span class="s2">this</span><span class="s1">.choices[code]</span><span class="s4">;</span><span class="s1"> 
                state.id = </span><span class="s3">'q3'</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
        </span><span class="s4">,</span><span class="s1"> 
        </span><span class="s3">'Issues'</span><span class="s1">: { 
            </span><span class="s3">'state'</span><span class="s1">: </span><span class="s3">&quot;q3&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'question'</span><span class="s1">: </span><span class="s3">&quot;[[contact.name]], what is the most important election issue for you?&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'instruction'</span><span class="s1">: </span><span class="s3">&quot;Select a letter only:&quot;</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'choices'</span><span class="s1">: { 
                </span><span class="s3">'P'</span><span class="s1">: </span><span class="s3">&quot;Poverty Alleviation&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'J'</span><span class="s1">: </span><span class="s3">&quot;Jobs Creation&quot;</span><span class="s4">,</span><span class="s1"> 
                </span><span class="s3">'H'</span><span class="s1">: </span><span class="s3">&quot;Healthcare&quot;</span><span class="s1"> 
            }</span><span class="s4">,</span><span class="s1"> 
            </span><span class="s3">'regex'</span><span class="s1">: </span><span class="s3">/^[PJH]$/</span><span class="s4">,</span><span class="s1"> 
            saveto: </span><span class="s2">function </span><span class="s1">() { 
                </span><span class="s2">var </span><span class="s1">code = message.content</span><span class="s4">;</span><span class="s1"> 
                contact.vars.issue_code = code</span><span class="s4">;</span><span class="s1"> 
                contact.vars.issue = </span><span class="s2">this</span><span class="s1">.choices[code]</span><span class="s4">;</span><span class="s1"> 
                state.id = </span><span class="s3">'done'</span><span class="s4">;</span><span class="s1"> 
            } 
        } 
    } 
} 
 
</span><span class="s2">var </span><span class="s1">object = _.where(survey.prompts</span><span class="s4">, </span><span class="s1">{state: </span><span class="s2">null</span><span class="s1">})</span><span class="s4">;</span><span class="s1"> 
 
console.log(object.question)</span><span class="s4">;</span></pre>
</body>
</html>